const _0x24773f=_0x3b31;function _0x3b31(_0x1827a3,_0x4af708){const _0x2dd588=_0x2dd5();return _0x3b31=function(_0x3b31db,_0x2c12e0){_0x3b31db=_0x3b31db-0xa3;let _0x21deea=_0x2dd588[_0x3b31db];return _0x21deea;},_0x3b31(_0x1827a3,_0x4af708);}function _0x2dd5(){const _0xf9b3fa=['default','5pzWuAc','mailgen','1910910JToJER','abcdefghijklmnopqrstuvwxyz','activationCode','random','startsWith','findOneAndUpdate','username','userId','bcryptjs','latec80676@galcake.com','Bearer','exports','createTransport','0123456789','findOne','sendMail','كود\x20التفعيل\x20خطأ','send','ABCDEFGHIJKLMNOPQRSTUVWXYZ','sign','JWT_EXPIRE_TIME','authorization','_id','103730dZXLQa','Mailgen','NODEMAILER_PASS','findByIdAndUpdate','jsonwebtoken','generate','1301060mfgnTQ','../utils/apiError','macAddress','express-async-handler','status','Generated\x20Code','one','205825VqNgIk','gmail','1979772gUyAaM','env','63FayOCG','NODEMAILER_EMAIL','User\x20Activation\x20Code\x20Has\x20Arrived!','password','headers','compare','1634899TuFsHT','json','join','https://mailgen.js/','Sky-Link','body','2150180dPqxvo','24xyBdCc','../models/user-model','nodemailer','address','JWT_SECRET_KEY'];_0x2dd5=function(){return _0xf9b3fa;};return _0x2dd5();}(function(_0xc2dc23,_0x3095ee){const _0x403045=_0x3b31,_0x2b677a=_0xc2dc23();while(!![]){try{const _0x4f45d7=parseInt(_0x403045(0xd9))/0x1+parseInt(_0x403045(0xcc))/0x2+-parseInt(_0x403045(0xdb))/0x3+parseInt(_0x403045(0xac))/0x4*(-parseInt(_0x403045(0xb3))/0x5)+-parseInt(_0x403045(0xb5))/0x6+parseInt(_0x403045(0xa6))/0x7*(parseInt(_0x403045(0xad))/0x8)+-parseInt(_0x403045(0xdd))/0x9*(-parseInt(_0x403045(0xd2))/0xa);if(_0x4f45d7===_0x3095ee)break;else _0x2b677a['push'](_0x2b677a['shift']());}catch(_0x552f6e){_0x2b677a['push'](_0x2b677a['shift']());}}}(_0x2dd5,0x5637d));const jwt=require(_0x24773f(0xd0)),bcrypt=require(_0x24773f(0xbd)),address=require(_0x24773f(0xb0)),macaddress=require('macaddress'),nodemailer=require(_0x24773f(0xaf)),mailgen=require(_0x24773f(0xb4)),asyncHandler=require(_0x24773f(0xd5)),ApiError=require(_0x24773f(0xd3)),UserModel=require(_0x24773f(0xae)),generateToken=_0x468b6e=>{const _0x2abba6=_0x24773f;return jwt[_0x2abba6(0xc8)]({'userId':_0x468b6e},process['env']['JWT_SECRET_KEY'],{'expiresIn':process[_0x2abba6(0xdc)][_0x2abba6(0xc9)]});},generateActivationCode=_0x217930=>{const _0x532544=_0x24773f,_0x5525c2=[..._0x532544(0xc7)],_0x451457=[..._0x532544(0xb6)],_0x4700df=[..._0x532544(0xc2)],_0xf5913e=[..._0x5525c2,..._0x4700df,..._0x451457];return[...Array(_0x217930)]['map'](_0x429f5f=>_0xf5913e[Math[_0x532544(0xb8)]()*_0xf5913e['length']|0x0])[_0x532544(0xa8)]('');};module[_0x24773f(0xc0)]={'userLogin':asyncHandler(async(_0x34c84e,_0x44b628,_0x58182e)=>{const _0x57dc2f=_0x24773f;macaddress[_0x57dc2f(0xd8)](async(_0x34f6f0,_0x591bc9)=>{const _0x114aae=_0x57dc2f,_0x26facf=await UserModel[_0x114aae(0xc3)]({'username':_0x34c84e[_0x114aae(0xab)][_0x114aae(0xbb)]});if(!_0x26facf||!await bcrypt[_0x114aae(0xa5)](_0x34c84e[_0x114aae(0xab)][_0x114aae(0xa3)],_0x26facf[_0x114aae(0xa3)]))_0x58182e(new ApiError('المستخدم\x20او\x20كلمة\x20السر\x20خطأ',0x191));else{if(!_0x26facf[_0x114aae(0xd4)]||_0x26facf[_0x114aae(0xd4)]==''){var _0x2b9af4=generateActivationCode(0x6),_0x227d3e=nodemailer[_0x114aae(0xc1)]({'service':_0x114aae(0xda),'auth':{'user':process['env'][_0x114aae(0xde)],'pass':process['env'][_0x114aae(0xce)]}}),_0x4bd2ce=new mailgen({'theme':_0x114aae(0xb2),'product':{'name':_0x114aae(0xcd),'link':_0x114aae(0xa9)}}),_0x3165ac={'body':{'name':'Sky-Link','intro':_0x114aae(0xdf),'table':{'data':[{'username':_0x26facf[_0x114aae(0xbb)],'activationCode':_0x2b9af4}]}}},_0x405bff=_0x4bd2ce[_0x114aae(0xd1)](_0x3165ac),_0x3887fc={'from':process[_0x114aae(0xdc)][_0x114aae(0xde)],'to':_0x114aae(0xbe),'subject':_0x114aae(0xd7),'html':_0x405bff};_0x227d3e[_0x114aae(0xc4)](_0x3887fc,async(_0x46c3db,_0x46250a)=>{const _0x3d9a9b=_0x114aae;if(_0x46c3db)_0x44b628[_0x3d9a9b(0xc6)](_0x46c3db);else{const _0x5d42ba=await UserModel[_0x3d9a9b(0xba)]({'username':_0x34c84e[_0x3d9a9b(0xab)][_0x3d9a9b(0xbb)]},{'activationCode':_0x2b9af4},{'new':!![]});_0x44b628[_0x3d9a9b(0xd6)](0xc8)[_0x3d9a9b(0xa7)]({'data':_0x5d42ba});}});}else{if(_0x26facf[_0x114aae(0xd4)]!=_0x591bc9){var _0x233c67='',_0x2b9af4=generateActivationCode(0x6),_0x227d3e=nodemailer[_0x114aae(0xc1)]({'service':_0x114aae(0xda),'auth':{'user':process['env'][_0x114aae(0xde)],'pass':process[_0x114aae(0xdc)][_0x114aae(0xce)]}}),_0x4bd2ce=new mailgen({'theme':_0x114aae(0xb2),'product':{'name':_0x114aae(0xcd),'link':'https://mailgen.js/'}}),_0x3165ac={'body':{'name':_0x114aae(0xaa),'intro':_0x114aae(0xdf),'table':{'data':[{'username':_0x26facf[_0x114aae(0xbb)],'activationCode':_0x2b9af4}]}}},_0x405bff=_0x4bd2ce[_0x114aae(0xd1)](_0x3165ac),_0x3887fc={'from':process['env'][_0x114aae(0xde)],'to':_0x114aae(0xbe),'subject':_0x114aae(0xd7),'html':_0x405bff};_0x227d3e[_0x114aae(0xc4)](_0x3887fc,async(_0xdd5a23,_0x577682)=>{const _0x7e0120=_0x114aae;if(_0xdd5a23)_0x44b628['send'](_0xdd5a23);else{const _0x53a9af=await UserModel[_0x7e0120(0xba)]({'username':_0x34c84e['body']['username']},{'macAddress':_0x233c67,'activationCode':_0x2b9af4},{'new':!![]});_0x44b628[_0x7e0120(0xd6)](0xc8)[_0x7e0120(0xa7)]({'data':_0x53a9af});}});}else{const _0x265462=generateToken(_0x26facf[_0x114aae(0xcb)]);_0x44b628['status'](0xc8)[_0x114aae(0xa7)]({'data':_0x26facf,'token':_0x265462});}}}});}),'checkToken':asyncHandler(async(_0xdf554f,_0x265cae,_0x113cfa)=>{const _0x10193d=_0x24773f;let _0x431571;_0xdf554f[_0x10193d(0xa4)]['authorization']&&_0xdf554f[_0x10193d(0xa4)][_0x10193d(0xca)][_0x10193d(0xb9)](_0x10193d(0xbf))&&(_0x431571=_0xdf554f[_0x10193d(0xa4)][_0x10193d(0xca)]['split']('\x20')[0x1]);if(!_0x431571)return _0x113cfa(new ApiError('من\x20فضلك\x20قم\x20بتسجيل\x20الدخول\x20اولا',0x191));const _0x24cce2=jwt['verify'](_0x431571,process[_0x10193d(0xdc)][_0x10193d(0xb1)]),_0x10fdd6=await UserModel['findById'](_0x24cce2[_0x10193d(0xbc)]);if(!_0x10fdd6)return _0x113cfa(new ApiError('The\x20user\x20that\x20belong\x20to\x20this\x20token\x20no\x20longer\x20exist',0x191));_0x113cfa();}),'checkActivationCode':asyncHandler(async(_0x5bfaad,_0x41c43c,_0x23c140)=>{macaddress['one'](async(_0x307e0c,_0x6be5db)=>{const _0x5eba45=_0x3b31,_0x154317=await UserModel['findById']({'_id':_0x5bfaad[_0x5eba45(0xab)]['userId']});if(!_0x154317||_0x154317[_0x5eba45(0xb7)]!=_0x5bfaad[_0x5eba45(0xab)][_0x5eba45(0xb7)])_0x23c140(new ApiError(_0x5eba45(0xc5),0x191));else{const _0x93032=await UserModel[_0x5eba45(0xcf)]({'_id':_0x154317[_0x5eba45(0xcb)]},{'macAddress':_0x6be5db},{'new':!![]}),_0xe99f52=generateToken(_0x154317[_0x5eba45(0xcb)]);_0x41c43c['status'](0xc8)[_0x5eba45(0xa7)]({'data':_0x93032,'token':_0xe99f52});}});})};